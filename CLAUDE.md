# CLAUDE.md

## 1. コミュニケーション

### 1.1 通知ポリシー

- 音声通知コマンド: `paplay /usr/share/sounds/freedesktop/stereo/complete.oga`
- 以下のタイミングで通知を行う
  - タスクの完了時
  - ユーザーの確認が必要なコマンドを実行する直前

### 1.2 会話ガイドライン

- 常に日本語で会話する

## 2. 開発ワークフロー

### 2.1 開発哲学

#### 2.1.1 テスト駆動開発 (TDD)

- 原則として TDD で進める
- t-wada 氏のテストフレームワークを使用する
- 漸進的な開発を重視し、機能ごとに小さなテストケースを作成

テスト駆動開発の進め方

1. 期待される入出力に基づき、まずテストを作成する
2. 実装コードは書かず、テストのみを用意する
3. テストを実行し、失敗を確認する
4. テストが正しいことを確認できた段階でコミットする
5. その後、テストをパスさせる実装を進める
6. 実装中はテストを変更せず、コードを修正し続ける
7. すべてのテストが通過するまで繰り返す
8. テストが通過したら、コミットする

#### 2.1.2 コード品質

- コメントは必要最低限（日本語）

### 2.2 バージョン管理

#### 2.2.1 Git 運用

- コミットは小さく意味のある単位で行う
- ブランチ命名規則: `feature/-`, `bugfix/-`, `hotfix/-`

#### 2.2.2 リリース & バージョニング

- Semantic Versioning (MAJOR.MINOR.PATCH) を採用
- 変更点は `CHANGELOG.md` に記載
- GitHub Releases でタグを発行し、同バージョンの Docker イメージを公開

### 2.3 Python

#### 2.3.1 依存関係管理

- `pyproject.toml` と `requirements.lock` をペアで管理
- `requirements.lock` は `uv pip compile --all` で生成
- ロックファイル更新は必ず PR に含める

#### 2.3.2 仮想環境

- `uv venv` で環境を構築
- 必ずuvの仮想環境を使用

#### 2.3.3 コード品質

- 必ず type hint を付与
- `ruff` でフォーマットと静的解析を実施
- `mypy` で型チェックを行う
- `pytest` を使用してユニットテストを実行
- `pytest-randomly` を使用してランダム性のあるテストを実行
- `pre-commit` を使用してコミット前に自動フォーマットと静的解析を実施

## 3. セキュリティ

### 3.1 Secrets 管理

- `.env.example` をリポジトリに置き、実 `.env` は Git 管理外とする
- GitHub secret scanning を有効化し、漏洩時はキーローテーションを迅速に実施
- Dependabot などで脆弱性を定期チェック

## 4. Docker & デプロイ

### 4.1 Docker 方針

- すべての Docker イメージに `HEALTHCHECK` を設定

### 4.2 Docker ベストプラクティス

- マルチステージビルドでイメージを軽量化
- 開発用と本番用でビルドステージを分離
- `latest` タグを避け、バージョンタグ（例: `v1.2.3`）を明示
- 不要なキャッシュレイヤを削除し、`--no-cache` ビルドを CI で定期実行
